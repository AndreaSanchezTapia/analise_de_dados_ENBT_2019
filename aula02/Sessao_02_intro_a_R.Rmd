---
title: "Disciplina: Projetos de análise de dados usando R"
subtitle: "[Dia 1, aula 2: Introdução ao ambiente estatístico R]()"
author: "Andrea Sánchez Tapia, Sara Mortara, Diogo Rocha"
date: "2019/06/17 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: true
---

<!-- falar de R
introduzir rstudio
falar da consola, do script, do workspace e do diretorio de trabalho,
falar de caminhos relativos,
falar do help,
do help das funcoes, 
de ajuda online,
falar de boas praticas de trabalho em R: 
-->

![](http://www.r-project.org/Rlogo.png)

+ uma **linguagem** de programação estatística criada em 1991 a partir de S e S-PLUS o código original tem mais de 40 anos e consistia em rotinas de FORTRAN para análise estatística

--

+ **software _livre_**: gratuito e de código livre, livre de ser usado e modificado para qualquer fim
+ __Cross-platform__: qualquer plataforma e sistema operacional

--

+ **Estrutura modular**: Uma estrutura básica e o resto com estrutura em pacotes, facilita a instalação e atualização
    + A `base` é desenvolvida e mantida pelo R Core Development Team
    + As pessoas escrevem pacotes, submetem para CRAN segundo umas regras estritas e os pacotes ficam disponíveis
    + Mais de 1500 pacotes no CRAN (The Comprehensive R Archive Network: http://cran.r-project.org/)
    + Outras fontes de pacotes: Bioconductor, github,  **rOpenSci.org**, páginas pessoais etc. 


---
## Vantagens de usar R

+ Robusteza: o código é escrito pelos especialistas
--

+ Suporte: uma comunidade ativa trabalhando nas mesmas perguntas que você
--

+ Interdisciplinário e extensível (listas de emails, stack overflow, rstudio community)
--

+ Reprodutibilidade: programação baseada em _scripts_
--

+ Flexibilidade: o usuário pode virar programador
--

+ Integração com outras ferramentas
--

+ Eficiência (rapidez, poder de computação)
--

+ Capacidade gráfica!
--

###  Filosofia 

[__Um ambiente interativo, que facilite a transição de usuário para programador__]()

---

# CRAN https://cran.r-project.org/

![](figs/cran.png)

"CRAN é uma rede de servidores ftp e web servers ao redor do mundo que guarda versões idênticas e atualizadas do código e documentação para R. Por favor use o espelho (_mirror_) de CRAN mais próximo de você para minimizar a carga da rede."  --> fiocruz

---
background-image:url("figs/0bb_packages.png")

---

## Onde rodar `R`?

+ R pode ser rodado desde qualquer __terminal__ de windows, mac, linux.
+ A interface original de R é uma consola onde o código é escrito
+ Na versão para windows e mac, tem um editor de texto incorporado e algumas opções (R-GUI)
+ Algumas interfaces gráficas e ajudas para executar:
  + Modo ESS do Emacs
  + RStudio
  
# RStudio não é R e não está fazendo as análises

--

.pull-right[
...mas estaremos usando RStudio
]

---
background-image:url("figs/00_rstudio.png")
background-size: 100%

---
background-image:url("figs/00_rstudio.png")
background-size: 100%

.pull-left[
<br>
<br>
##Script
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
##Consola (o R vive aqui)
]

.pull-right[
<br>
<br>
## Environment
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
### Abas com funções adicionais
]


 <!-- abrir, 
 Arquivo > Novo arquivo > R script
4 esquinas, o script, a consola, algumas abas que iremos explorando 1. foco en el script
getwd() control enter, algo similar a esto debe aparecer
 dà para escribir lo mismo en la consola pero no va a quedar guardado. 
 el script puede ser salvado. 
 la hitoria va a registrar ambas cosas
 a maior parte do trabalho vai ser aqui e quando tiver um plot vai na aba de plots, quando tiver algum objeto no ambiente, ele vai ser listado no ambiente
 --> 

---
## Uma breve introdução a R

Uma sessão de trabalho em R inclui:

+ Criar objetos ou ler os dados do HD para "dentro" da sessão (o [workspace]())
+ Trabalhar com os objetos do workspace, executando funções de pacotes 
+ Salvar o output no HD de volta
 <!-- * Para executar as funções recomenda-se o uso de um __script__, não executar diretamente na consola --> 
 
 <br>
 <br>
 <br>
 <br>
 
 
    Tudo o que existe são objetos.  
    Tudo o que acontece são chamadas a funções
                         Chambers, 2014
                         
---
## Uma breve introdução a R

[__Criar objetos que são salvos na memória temporal (RAM) do computador__]()

```{r}
ls() # lista os objetos guardados na memória
3 + 2 # executa a soma
ls()
```

---
## Uma breve introdução a R

+ O operador [__`<-`__]() assigna o nome ao objeto


```{r}
ls()
a <- 3 # cria o objeto a
# para obter o valor de a o comando "a" deve ser executado
a 
ls()
```

O objeto __`a`__ foi criado e agora ele está no [__workspace__]()

---

# Os objetos são armazenados na memória RAM (temporariamente) no [__workspace__]() da sessão.
# O operador [__`<-`__]() assigna o nome ao objeto
# Para ver o que há no workspace: [`ls()`]()

---
## Sobre o workspace...

+ R pode salvar o workspace (.RData) e restabelecê-lo entre sessões

#### Só porque você pode fazer algo não quer dizer que você _deva_ fazê-lo
#### A recomendação é depender do [__script__]() para reconstituir todo o fluxo de trabalho. 
#### Caso seja necessário, usar o script para salvar objetos maiores no HD (para que estes possam ser lidos posteriormente).

![](figs/crochet.jpg){width=200px}

---

## O script de R
* Arquivo de texto com extensão .R
* Manda as instruções para a consola com ctrl + Enter (em RStudio) 
* [__O script é mais importante do que o workspace!__]()

* Permite saber o que foi feito e quando, recriar o workspace, assegura a reprodutibilidade da análise, permite a troca de análises.
    
* É a unidade de busca e troca entre pesquisadores e está sendo anexada a publicações científicas para que você possa fazer suas análises :)


---
## A pasta de trabalho: __Working directory__

Toda sessão de R é executada em uma pasta específica do computador, a pasta de trabalho. 

* Armazena o workspace
* Lê os arquivos e outros objetos
* Onde deve ir o script

__Onde estou trabalhando?__ `getwd()`  

+ Qual é o resultado de sua chamada a `getwd()`?

+ Cada projeto de análise deveria ter sua própria pasta. 

`andreasanchez


---
# Caminhos relativos


---
## Boas práticas de trabalho em R

1. Manter cada projeto de R em uma única pasta de trabalho ✔
2. Usar sempre script e comentar muito o código (`#`) ✔
3. Criar um arquivo de metadados (README).
3. Ter uma estrutura de pastas e subpastas que permita organizar a informação adequadamente, separando __dados originais__, __outputs__ e __documentação__ (`./data`,`./outputs`, `./figs` e `./docs`, por exemplo).
4. Usar caminhos relativos (_relative pathways_) para ler os dados dentro dessa estrutura de pastas.
 
---

# Instalar pacotes


```{r, eval =F}
install.packages("vegan")
```

```{r, eval =T}
library("vegan")
citation("vegan")
```

---

# O help de R

* R possui ampla documentação de cada função e pacote.

```{r,eval = FALSE}
?anova
??anova
help(anova)
```

* A estrutura do help é sempre similar: Description, Usage, Arguments... Details, Notes, References, See Also, Examples 

* O uso de todas as funções é:   
`nome da função(argumentos)`

---
# Onde buscar ajuda?

+ A pessoa do seu lado.
+ Colegas mais experientes
+ google
+ Stack Overflow: leia bem as instruções para postar perguntas e tente dar exemplos
+ A lista de emails de R-help: um monte de pessoas lê e posta mas o tom pode ser um pouco seco. 
+ Os autores do pacote ou os repositorios de github 
+ A comunidade de RStudio community.rstudio.com
+ Listas de emails específicas (GIS, phylogenetics, etc…)
+ Twitter, hashtag `#rstats`


https://datacarpentry.org/R-ecology-lesson/00-before-we-start.html  
http://datacarpentry.org/semester-biology/materials/googling-for-help/  
http://community.rstudio.com


---
# A estrutura de pastas de um projeto de análise








---
# [FOI!]()
![](https://media.giphy.com/media/3oriO04qxVReM5rJEA/giphy.gif)

---

# Configuração inicial: Checar no computador

+ Instale R
+ Instale RStudio
+ Instale git (https://git-scm.com/)
+ Crie uma conta de github (https://github.com/) 

---
background-image:url("figs/0a_setup.png")
---
background-image:url("figs/0b_soft_wrap.png")
---
background-image:url("figs/0bb_packages.png")
---
background-image:url("figs/0c_codificacao.png")
---
background-image:url("figs/0d_terminal.png")

---
# Configurações gerais


1. Abra RStudio - se abrir, R está bem instalado.
2. Abra um terminal usando `Ferramentas > Terminal > Novo Terminal`
3. Teclei `pwd` no Terminal. pwd significa `print working directory`, deve ter o nome de uma pasta. Qual é?  <!-- anotar o de todos -->

[Até aqui RStudio, R e o terminal dentro de RStudio estão funcionando]()

---
# Configurações gerais

5. No Terminal, tecle:  
`git config user.name`   
`git config user.email`   
Nada deve aparecer, se algo aparecer avisa

--

6. Agora tecle:  
`git config user.name "seu nome"`  
`git config user.email "seu email do github!"`   

--

7. Agora confira de novo:  
`git config user.name`  
`git config user.email`  
__As variáveis que você inseriu devem aparecer__

## [Até aqui git está configurado no computador e ele sabe quem é você. Vamos conectar o seu computador com "a nuvem"]()

---
### Desde RStudio 

1. `Preferencias > git/svn`
1. Checar que git está apontando para um arquivo `git.exe`
2. O campo SVN vazio
3. Naõ deve ter nada no campo da chave RSA.
4. `Criar RSA Key`
5. Ver a RSA Key, copiar a chave. Ela é uma chave que identifica seu computador e vamos copiá-la no github.com

### No Github

1. Log in
2. Perfil > Chaves ssh > criar uma chave ssh
4. Nome de seu computador
5. Colar a chave que tinha sido copiada. 
6. Add, OK. 

## [Até aqui github e seu computador podem se comunicar]() :D

---

### Criar um repositório de trabalho

#### No Github
1. Novo repositório (botão verde). Nomeie, público, YES, com readme. 
2. Botão verde: `Clone or download`. From ssh. Click no ícone de copiar

#### No RStudio
1. `New project...`
2. Version control
3. git
4. URL-> __COLE__
5. Selecione a pasta onde seu repositório vai estar. __Não a pasta do repositório__
6. Open in new session
7. OK

---
# Checando que tudo deu certo

+ Abra o terminal e digite `pwd` a pasta deve ser aquela que você indicou
+ Agora crie um novo script de R e digite `getwd()`
+ Para mandar linhas de código para a consola, `ctr+enter`


```{r remedy003}
getwd()
```
---

+ O setup que realizamos previamente fez com que a __pasta de trabalho__ ficasse associada a um __projeto de RStudio__
+ Vejam o arquivo .rproj na pasta onde vocês estão.

---

